@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@inject IState<Language.State> LanguageState
@inject IDispatcher Dispatcher
@inject IConfigProvider ConfigProvider

<Flag Class="layout-navigation-languageSelect-flag" Name="@LanguageState.Value.Language" @onclick="OpenMenu" @ref="flag">@LanguageState.Value.Language.ToUpper()</Flag>
<MatMenu @ref="menu">
    <MatList>
        @foreach (var lang in _languages)
        {
            <MatListItem @onclick="()=>SelectLanguage(lang)">
                <Flag Class="layout-navigation-languageSelect-flag" Name="@lang">@lang.ToUpper()</Flag>
            </MatListItem>
        }
    </MatList>
</MatMenu>
@code{
    Flag flag;
    MatMenu menu;
        
    string[] _languages = new string[] { };
    protected override async Task OnInitializedAsync()
    {
        var config = await ConfigProvider.GetConfig();
        _languages = config.Languages;
    }

    void OpenMenu(MouseEventArgs e)
    {

        menu.OpenAsync(flag.Ref);
    }

    void SelectLanguage(string language)
    {
        Dispatcher.Dispatch(new Language.ChangeLanguageAction(language));
    }

}
